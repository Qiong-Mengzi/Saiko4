# Saiko v4 Sine Wave Synthesizer

一个简陋的正弦波声音合成器。(v4.0.2)

## Sample

在该文件夹下打开命令行，输入：

```bash
python Saiko4/SheetV2.py Sample/Sample1
```

此命令将会在 `Sample` 目录下生成 `Sample1.wav` 文件。

NOTE: 不要写文件扩展名，也不要在 `python` 后添加 `-m` 参数。

## Sksheet乐谱文件格式

整体上遵循 `JSON` 格式。（所以你可以使用JSON语法高亮）

![](/img/format.jpg)

+ `Saiko` : 使用的Saiko合成器版本，可省略。（可能有警告）

+ `Voice` : 乐谱所用音色的定义。

    - 音色名必须唯一（`none` 为默认音色，即没有声音。请不要使用 `none` 作为新的音色名）
    - 音色的键是对应的频率（基频的倍数）
    - 音色的值是对应的振幅（复数。实部为余弦分量，虚部为正弦分量）

+ `A4` : A4音高所对应的频率，默认为440（浮点数）

+ `sr` : 采样率，默认为64000. 可以适当减小该值来加快合成速度。（如44100）

    至于为什么是 `64000`，这是一个初二开始(2021年)的历史遗留问题。

+ `volume` : 音量的缺省值，默认为1.0

+ `envelop` : 乐谱所用包络线定义

    - 包络线名必须唯一（`default` 为默认包络线，如果需要可以覆盖，通常这很有用）
    - 包络线值为浮点数，每个浮点数代表一个控制点，每个控制点之间的间隔是相同的。

+ `slide` : 乐谱所用音高线定义

    - 音高线名必须唯一（`default` 为默认音高线。如非必要请不要覆盖它）
    - 音高线值为浮点数，同包络线。

+ `Synth` : 合成参数

    - `window-length` : 窗长，即进行ISTFT离散傅里叶逆变换时所用窗长。

        必须为整数，请根据具体情况选择。

    - `norm` : 布尔值，如果为 `true`，则会对每一个生成音符进行归一化

        请注意，它并不会对音符的音量进行放大，所以需要时应对每一个音符的音量的调整。

    - `offset` : 窗滑动步长，整数，默认为4. 实际值为 `[window-length] / [offset]`

        通常这个值无需调整。如果过小会导致包络线出现问题，过大会加大计算量并且带来不可预知的问题（谐波方面）
    
+ `PCM` : 输出音频编码格式，目前支持 `PCM_16`，`PCM_24` 和 `PCM_32`。

    默认为 `PCM_16`

+ `Sheet` : 乐谱的主体部分。其中每一个键都是一个音轨的命名，每一个值都是一个音轨。

    音轨的命名是给人看的。

    - 音轨是一个列表，其中每一个对象都是一个音符。

    - 音符：

        + `voice` : 音色名，不可在音符内定义。

        + `pitchs` : 音高，一个列表，其中每一个字符串都是音高名。

            所有可用的音高在 [pitch.py](/Saiko4/pitch.py) 的 `PITCH` 常量中定义。

        + `freqs` : 频率，一个列表，其中每一个浮点数都是频率。

            *如果 `pitch` 和 `freqs` 同时存在，则优先使用 `freqs`。*

            *如果都没有，则该音符为休止符。*

        + `delay` : 时延，一个浮点数，单位是秒。

        + `length` : 采样数，整数。

            *如果 `delay` 和 `length` 同时存在，则优先使用 `length`。*

        + `envelop` : 该音符使用的包络线。

            可以是在乐谱定义的包络线（字符串），也可以是临时使用的音高线（浮点数列表，优先使用）
        
        + `slide` : 该音符使用的音高线。

            可以是在乐谱定义的音高线（字符串），也可以是临时使用的音高线（浮点数列表，优先使用。通常这种方式更加通用，毕竟每个音符的音高线通常不一致）
        
        + `volume` : 该音符的音量，如果没有则使用缺省值。

## Release Note

### v4.0.2

+ 重构 `Sheet.py` (到 `SheetV2.py`)，要不然这代码有点太OI化了。

+ 修正包络线合成错误。（其实是音符长度过长导致）

    NOTE: `Sheet.py` 未修正该错误，故请不要使用。

### v4.0.1

+ Saiko4 的第一个版本
